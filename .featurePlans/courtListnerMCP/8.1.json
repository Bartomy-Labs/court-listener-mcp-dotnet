{
  "taskId": "8.1",
  "title": "Create Test Project",
  "phase": "8",
  "phaseTitle": "Testing & Documentation",
  "taskNumber": 1,
  "totalTasksInPhase": 2,
  "complexity": "moderate",
  "objective": "Set up unit and integration testing with Moq and shared test helpers",

  "contextManagement": {
    "isFirstInPhase": true,
    "isLastInPhase": false,
    "requiresContextLoad": true,
    "loadContextFrom": "ingestion_phaseBoundary_phase7_20251006.md",
    "phaseBoundaryInstructions": null
  },

  "codebaseVerificationEvidence": {
    "verifiedFiles": [
      ".featurePlans/courtListnerMCP/CourtListnerMCPServer.md (lines 517-567)"
    ],
    "verifiedMethods": [],
    "assumptionAudit": {
      "assumptionLanguageDetected": false,
      "assumptionCount": 0,
      "confidence": "HIGH",
      "notes": "All specifications verified. GAP #6 (Moq + shared helpers) implemented."
    }
  },

  "agentInstructions": "**OBJECTIVE**: Create test project with xUnit, Moq, and shared test helpers.\n\n**EXECUTION STEPS**:\n\n1. **Create Test Project**:\n   ```bash\n   dotnet new xunit -n CourtListener.MCP.Server.Tests\n   dotnet sln add CourtListener.MCP.Server.Tests\n   dotnet add CourtListener.MCP.Server.Tests reference CourtListener.MCP.Server\n   ```\n\n2. **Add Moq Package**:\n   ```bash\n   cd CourtListener.MCP.Server.Tests\n   dotnet add package Moq\n   ```\n\n3. **Create TestHelpers Class**:\n   ```csharp\n   public static class TestHelpers\n   {\n       public static Mock<HttpMessageHandler> CreateMockHttpHandler()\n       {\n           return new Mock<HttpMessageHandler>();\n       }\n       \n       public static void MockSuccessResponse<T>(Mock<HttpMessageHandler> handler, T data)\n       {\n           handler.Protected()\n               .Setup<Task<HttpResponseMessage>>(\"SendAsync\", ItExpr.IsAny<HttpRequestMessage>(), ItExpr.IsAny<CancellationToken>())\n               .ReturnsAsync(new HttpResponseMessage\n               {\n                   StatusCode = HttpStatusCode.OK,\n                   Content = new StringContent(JsonSerializer.Serialize(data))\n               });\n       }\n       \n       // Additional helper methods for 404, 401, 429, 500...\n   }\n   ```\n\n4. **Create Sample Test Categories**:\n   - SearchToolsTests.cs (test SearchOpinions, etc.)\n   - GetToolsTests.cs (test GetOpinion, etc.)\n   - CitationToolsTests.cs (test LookupCitation, etc.)\n   - ErrorHandlingTests.cs (test all error types)\n\n5. **Verify**:\n   - Run: `dotnet test`\n   - All tests pass offline (< 1 second)\n   - Aim for >70% code coverage\n\n**DELIVERABLES**:\n- CourtListener.MCP.Server.Tests project\n- Moq package installed\n- TestHelpers class with shared mocks\n- Sample test categories created\n\n**VERIFICATION CHECKLIST**:\n- [ ] Test project created and added to solution\n- [ ] Moq package installed\n- [ ] TestHelpers class created\n- [ ] Sample test files created\n- [ ] Tests run offline\n- [ ] Project builds successfully",

  "successCriteria": [
    "Test project builds and runs",
    "All tests pass offline (< 1 second total execution)",
    "Basic test coverage for all tool categories (aim for >70%)",
    "Mocking framework configured with shared helpers"
  ],

  "criticalAnchors": [
    "Use xUnit test framework",
    "Moq + Shared Test Helpers (GAP #6)",
    "Mock HTTP responses for offline testing",
    "Target >70% code coverage"
  ],

  "associatedArtifacts": [
    {
      "type": "project",
      "path": "CourtListener.MCP.Server.Tests/CourtListener.MCP.Server.Tests.csproj",
      "description": "xUnit test project"
    },
    {
      "type": "class",
      "path": "CourtListener.MCP.Server.Tests/TestHelpers.cs",
      "description": "Shared test helper methods"
    }
  ],

  "executionControls": {
    "estimatedDuration": "25-35 minutes",
    "requiresUserInput": false,
    "canRunOffline": true,
    "requiresExternalServices": false,
    "prerequisiteTasks": ["7.1"],
    "blockedBy": [],
    "pauseBeforeExecution": false,
    "pauseAfterExecution": false
  },

  "gapDecisionReferences": [
    {
      "gapId": "GAP #6",
      "gapTitle": "Testing Strategy",
      "decision": "Moq + Shared Test Helpers",
      "implementation": "xUnit + Moq for HttpMessageHandler mocking, TestHelpers class for reusable mock setups, offline testing"
    }
  ],

  "metadata": {
    "generatedAt": "2025-10-06T19:30:00Z",
    "generatedBy": "L.E.A.S.H. Ingestion v3.2.0-git",
    "planSource": ".featurePlans/courtListnerMCP/CourtListnerMCPServer.md",
    "confidenceLevel": "HIGH"
  }
}
